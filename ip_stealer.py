import os
import sys
import time
import socket
import ctypes
from scapy.all import ARP, Ether, srp
from colorama import init, Fore, Style

init()

SKULL_ART = r"""%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#*+=-::::::-=+#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*:::::::::::::::::::::::-*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%+::::::::::::::::::::::::::::::::*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%+::::::::::::::::::::::::::::::::::::::*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%#-::::::::::::::::::::::::::::::::::::::::::%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%*::::::::::::-:::::::::::::::::::::::::::::::::+%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%-::::::::::::--==+==+=::====-:-=+*+*=-::::::::::=#%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%#*=:::::::--+*+=*##*++=-=*++*=+-====*+*%#+++=-:::::+%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%**%=:::::==%%%%%%%%%%%#+*#*%%%%%%+%%+%%%##%%%%%*-*-::=%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%#+*+:::+#%%%%%%%%%%%%%%%*%%***:*%%%%*#%%%%%%%%%%%%%=*=:-%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%#**==*#%%%%%%%%%%%%%%%%%%%%%#:+:=%%%+%%%%%%%%%%%%%%%%%#*++%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%***##%%%%%%%%%%%%%%%%%%%#%**=-+%=:#%*%%%%%%%%%%%%%%%%%%##%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%###%%%%%%%%%%%%%%%%%%%%%%%#-*#%%%%%**#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%#*+-*-%%%%%%%%%%%%%%%%%%%%*++%%%%%%%%*+%%%%%%%%%%%%%%%%%%%*%#%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%**#%%:*%%%%%%%%%%%%%%%%%++#*%%%%%%%%%%%+-#%%%%%%%%%%%%%%%%#-**%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%**#*%#:*%%%%%%%%%%%%%%#:::+#*%%%%%%%%%%%**::=%%%%%%%%%%%%%%#:##+%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%#####%-::#%%%%%#%*+=:::::=#%*%%%%%%%%%%%%%**=:::::--=##:::-=-:+#+%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%*#%#%%-=-:::-*-:-+#%%==**%%%%%%%%%%%%%%%%%##**+::#%##*+=-###*+-=*#%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%*#%%%%%#=+%=-:-=++**#%*:=+***%%%%%%%%%%%%%%%+++-::*#+*+++**:==#+#*+%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%###+##**#**+-:--=++++++:::-+*%%%%%%%%%%%%%%%-+=::::+=-::-::-*++*%%##%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%##%#*##*##*###=+=:::::::::===%%%%%%%%%*%%%%%-==::::::::::::=*+%%%#%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%####%%%%*#******=::::::::::::=%%%%%%#+*+%%%---+:::::-=:+#+*++++%#%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%*%%%%%%%%#%%#**#++=-::--::::::+*##*#+*##*%%##+#::+=**++*==+#%#+=#%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%*%%%%%%%%%%%%%%##**=-+*:-*:*%##*%%-:#%%#*%%%#%%%#=**###+#%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%#**%%%%%%%%%%%%#=*#=##%%%*:*%+:::#%::=%#:*%%%%=###+%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%#%%%%%%%%%%%%%#%%%%%*-%::-%%%%%%#:::+%=-%%%%#%#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%+=%%%%%%%%%%%%%%%%%*%%%#:%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#%%%-%%%%%%%%%%%%%%%%%%%%%%%%%*+%%%%%%%%%%##%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%++%%%+**%%%#*#+:=%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*%%##%%%%%:=%-+-%%%%=##:#-:%#:-%*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*:%#%:*%::#%%%*%%%%%:*%%+-%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#%%%*==%-=%%%%*%%%%%+%%%+%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%+%%%%%%%*%%#%#%%%**%#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#%%%%%%#+%%%%*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*%%%%+%%+%%%%%%%%%#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*%%%%%%%#%%%%#%%%=%#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%+#%=%%%%%%%%%%%%##%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#%%#%%%%%%%%%%%%#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%"""

def slow_print(text, delay=0.02):
    for c in text:
        print(c, end='', flush=True)
        time.sleep(delay)
    print()

def is_admin():
    try:
        return ctypes.windll.shell32.IsUserAnAdmin()
    except:
        return False

def get_local_ip():
    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    try:
        s.connect(("8.8.8.8", 80))
        return s.getsockname()[0]
    finally:
        s.close()

def scan_network(target_ip):
    ether = Ether(dst="ff:ff:ff:ff:ff:ff")
    arp = ARP(pdst=target_ip)
    packet = ether / arp
    result = srp(packet, timeout=2, verbose=0)[0]

    clients = []
    for sent, received in result:
        clients.append({
            "ip": received.psrc,
            "mac": received.hwsrc
        })
    return clients

def display_results(clients):
    print(Fore.GREEN + "\n[+] Victims Found:\n" + Style.RESET_ALL)
    print("IP" + " "*18 + "MAC")
    print("-"*40)
    for client in clients:
        print("{:16}    {}".format(client['ip'], client['mac']))

def log_to_file(clients, filepath):
    with open(filepath, "a") as f:
        f.write("---- New Scan ----\n")
        for client in clients:
            f.write(f"{client['ip']}\t{client['mac']}\n")

def main():
    # Yêu cầu quyền admin nếu chưa có
    if os.name == "nt" and not is_admin():
        print("[!] This script needs to run as Administrator.")
        ctypes.windll.shell32.ShellExecuteW(None, "runas", sys.executable, __file__, None, 1)
        input("Press Enter to exit...")
        sys.exit()

    os.system('cls' if os.name == 'nt' else 'clear')
    print(Fore.LIGHTBLACK_EX + SKULL_ART + Style.RESET_ALL)

    print(Fore.RED + "╔═════════════════════════════╗")
    print("║" + Fore.CYAN + "       IP-STEALER v1.4.1     " + Fore.RED + "║")
    print("╚═════════════════════════════╝" + Style.RESET_ALL)

    local_ip = get_local_ip()
    base_ip = ".".join(local_ip.split(".")[:-1]) + ".1/24"
    obscured_ip = ".".join(local_ip.split(".")[:-1]) + ".xxx"

    slow_print(f"[*] Local IP: {obscured_ip}")
    slow_print(f"[*] Scanning range: {base_ip}")

    mode = input(Fore.YELLOW + "\nMode? (live/log/normal): " + Style.RESET_ALL).strip().lower()
    log_path = None

    if mode == "log":
        log_path = input(Fore.YELLOW + "Log file path: " + Style.RESET_ALL).strip()

    def run_scan():
        clients = scan_network(base_ip)
        display_results(clients)
        if log_path:
            log_to_file(clients, log_path)

    if mode == "live":
        try:
            while True:
                run_scan()
                time.sleep(10)
                print(Fore.YELLOW + "\n[~] Refreshing scan...\n" + Style.RESET_ALL)
        except KeyboardInterrupt:
            print(Fore.RED + "\n[!] Live scan stopped." + Style.RESET_ALL)
    else:
        run_scan()

if __name__ == "__main__":
    main()

#AY WHY ARE YOU HERE? I SAID NO VIRUS ALREADY
